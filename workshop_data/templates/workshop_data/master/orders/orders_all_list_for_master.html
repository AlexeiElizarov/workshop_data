{% extends 'main.html' %}
{% load static %}
% load test_tag %}

{% load order_templatetags %}
{% load static %}

{% block title %}
    Наряды за {{ month }}
{% endblock title %}

{% block content %}
    <link rel="stylesheet" href="{% static 'css/worker_css/orders_table.css' %}">
    <form method="GET">
        {% csrf_token %}
        {{ filter_date.form }}
        {{ filter_date.form.media }}
        <input type="submit" value="Найти">
    </form>
    <hr>
    <table class="table table-success table-striped">
        <thead>
            <tr>
                <th scope="col">#</th>
                <th scope="col">Дата</th>
                <th scope="col">Месяц</th>
                <th scope="col">Цех</th>
                <th scope="col">Фамилия</th>
                <th scope="col">Партия</th>
                <th scope="col">Изделие</th>
                <th scope="col">Деталь</th>
                <th scope="col">Категория</th>
                <th scope="col">Операции</th>
                <th scope="col">Этап</th>
                {% comment %}
                <th scope="col">Выполнено</th>
                {% endcomment %}
                {% comment %}

                <th scope="col">Время работы</th>
                {% endcomment %}
                <th scope="col">Колличество</th>
                <th scope="col">Расценка</th>
                {% comment %}

                <th scope="col">Заработок в час</th>
                {% endcomment %}
                <th scope="col">Действия</th>
            </tr>
        </thead>
        <tbody>
    {% for order in orders %}
        <tr>
            <th scope="row">{{ forloop.counter }}</th>
            <td>{{ order.date }}</td>

            {% if request.user.position == 'MSR' %}
            <td>
                {% if order.month == 13 %}
                    <a href="" style="color: red">{{ order.get_month_display }}</a>
                {% else %}
                    <a href="{% url 'all_orders_list_for_all_workers_month' month=order.month %}">
                    {{ order.get_month_display }}
                    </a>
                {% endif %}
            </td>
            {% else %}
            <td>
                {% if order.month == 13 %}
                    <a href="{% url 'order_user_edit' username=user.username id=order.id %}" style="color: red">{{ order.get_month_display }}</a>
                {% else %}
                    <a href="{% url 'all_orders_list_for_all_workers_month' month=order.month %}">
                    {{ order.get_month_display }}
                    </a>
                {% endif %}
            </td>
            {% endif %}


            <td>{{ order.workshop }}</td>
            <td>
                <a href="{% url 'orders-worker-surname-for-master' username=order.user.username %}">
                    {{ order.user.surname }}
                </a>
            </td>
            <td>{{ order.batch }}</td>
            <td>
                <a href="{% url 'all_orders_list_for_all_workers_product' product=order.product %}">
                    {{ order.product }}
                </a>
            </td>

            <td>
                <a href="{% url 'all_orders_list_for_all_workers_detail' detail_id=order.detail.id %}">
                    {{ order.detail }}
                </a>
            </td>

            <td>
                <a href="{% url 'all_orders_list_for_all_workers_category' category=order.detail.category %}">
                    {{ order.detail.category }}
                </a>
            </td>
            <td>
                {% if order.stage %}
                    {{ order.stage.get_operations }}
                {% else %}
                    {{ order.operations }}
                {% endif %}
            </td>
            <td>
                {% if order.stage %}
                    {{ order.stage.get_name_work }}
                {% endif %}
            </td>

            {% comment %}

            ******** не работает возможность менять статус колонки "Выполнено" ********

            {% if request.user.position == 'MSR' %}
            <td>
                {% get_stage_in_work_done_tag order=order user=order.user batch_id=order.batch.id
                operations=order.operations %}
            </td>
            {% else %}
            <td>
                <a href="{% url 'stage_work_done' username=order.user batch=order.batch operations=order.operations %}">
                    {% get_stage_in_work_done_tag order=order user=order.user batch_id=order.batch.id
                    operations=order.operations %}
                </a>
            </td>
            {% endif %}
            {% endcomment %}

            {% comment %}

            <td>
                <div class="time_of_work_form">
                    {{ order.time_of_work_order }}
                    {% if request.user.position != 'MSR' %}
                    {% include 'workshop_data/worker/includes/time_of_work_form.html' %}
                    {% endif %}
                </div>
            </td>
            {% endcomment %}
            <td>
                {% if order.quantity %}
                    {{ order.quantity }}
                {% elif order.stage.quantity %}
                    {{ order.stage.quantity }}
                {% else %}
                    нет расценки
                {% endif %}

            </td>
            <td>
                {% if order.price %}
                    {{ order.price }}
                {% elif order.stage %}
                    {{ order.stage.price }}
                {% endif %}
            </td>
            {% comment %}

            <td>
                {% get_cost_per_hour_tag order %} руб.
            </td>
            {% endcomment %}
            <td>{% include 'workshop_data/worker/includes/button_dropdown_menu.html' %}</td>
        </tr>
    {% endfor %}
        <tr>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            {% comment %}

            <td>
                {% if average_price_per_month %}
                {{ average_price_per_month }}
                {% elif average_price %}
                {{ average_price }}
                {% endif %}
            </td>
            <td>
                {% if average_cost_per_hour_per_month >= 0 %}
                {{ average_cost_per_hour_per_month }}
                {% elif average_cost_per_hour %}
                {{ average_cost_per_hour }}
                {% endif %}
            </td>
            {% endcomment %}
            <td></td>
        </tr>
        </tbody>

    </table>

{% endblock content %}